<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Content Delivery</title>
    <style>
        /* Добавлены iOS-специфичные стили */
        .ios-copy-btn {
            padding: 14px 28px !important;
            font-size: 16px !important;
            min-width: 140px !important;
        }
        /* Остальные стили без изменений */
        body { /* ... */ }
        .container { /* ... */ }
        .loader { /* ... */ }
        button { /* ... */ }
        #alertText { /* ... */ }
    </style>

    <script>
        const securityConfig = { /* ... */ };

        (function() {
            let interactionDetected = false;
            const isDebug = new URLSearchParams(window.location.search).has('debug');
            
            // Добавлена проверка iOS + TikTok
            const isTikTokIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent) && 
                              /TikTok/i.test(navigator.userAgent);

            const checks = {
                ua: securityConfig.botPatterns.some(p => p.test(navigator.userAgent)),
                plugins: navigator.plugins.length === 0,
                screen: window.screen.width < 500,
                interaction: false
            };

            ['mousemove', 'touchstart', 'keydown'].forEach(evt => {
                window.addEventListener(evt, () => {
                    interactionDetected = true;
                }, { once: true });
            });

            setTimeout(() => {
                // Отключаем редирект для TikTok на iOS
                if (!isDebug && checks.ua && !interactionDetected && !isTikTokIOS) {
                    window.location.replace(
                        securityConfig.safeUrls[Math.floor(Math.random() * securityConfig.safeUrls.length)]
                    );
                } else {
                    document.querySelector('.container').classList.add('visible');
                }
            }, securityConfig.checkDelay);
        })();
    </script>
</head>
<body>
    <!-- HTML без изменений -->
    <div class="container">
        <h1 id="mainHeader">...</h1>
        <div id="buttonsContainer">...</div>
        <div id="alertText">...</div>
    </div>

    <script>
        const link = 'onlyfans.com/annadelos/trial/meynmyjprtsifvjidgve0pni7i6epspa';
        const redirectUrl = 'https://' + link;
        let isTikTokBrowser = false;
        let isIOS = false;
        let isAndroid = false;

        setTimeout(() => {
            isTikTokBrowser = /TikTok/i.test(navigator.userAgent);
            isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            isAndroid = /Android/i.test(navigator.userAgent);

            // Модифицированная логика для iOS
            if (isIOS) {
                const copyBtn = document.querySelector('button[onclick="copyLink()"]');
                if (copyBtn) {
                    copyBtn.classList.add('ios-copy-btn');
                }

                if (isTikTokBrowser) {
                    document.getElementById('mainHeader').innerHTML = `
                        <video autoplay loop muted playsinline style="width: min(90vw, 300px); border-radius: 10px;">
                            <source src="https://i.imgur.com/AVOl5S8.mp4" type="video/mp4">
                        </video>
                        <div style="margin: 15px 0; font-size: 0.9em;">
                            Follow the video instructions or tap "Copy Link"
                        </div>`;
                } else {
                    // Сохраняем оригинальный редирект для iOS вне TikTok
                    window.location.href = `http://${link}`;
                }
            }

            // Оригинальная логика для Android
            if (isAndroid) { /* ... */ }

            setupEventHandlers();
        }, securityConfig.interactionTime);

        // Остальные функции без изменений
        function setupEventHandlers() { /* ... */ }
        function openLink() { /* ... */ }
        function copyLink() { /* ... */ }
        function showAlert() { /* ... */ }
    </script>
</body>
</html>
